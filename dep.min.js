(dep=function(a){function h(b,c){var e,f,j=g[b]||(g[b]=[]);c&&j.push(c);if(e=d[b]){d[b]=0,e.length||i(b);while(f=e.shift())h(f)}else a.load&&a.load(b)}function i(a){var d=b[a],h=g[a],j;if(!e[a]){e[a]=1,(j=f[a])&&j();while(j=h.shift())j();while(j=d&&d.shift())--c[j]==0&&i(j)}}var b={},c={},d={},e={},f={},g={};return a.use=function(a,b){e[a]?b():h(a,b)},a.define=function(a,i,j){var k,l,m=[];while(l=i&&i.shift())e[l]||(m.push(l),(b[l]||(b[l]=[])).push(a));d[a]=m,c[a]=m.length,f[a]=j,g[a]&&h(a)},a})(dep);